# Web Ghost v33 (고스트 확대 + UI 스케일 조정 + 모듈식 UI3 버전)

이 버전은 사용자가 실제로 쓰기 편하도록 **고스트 크기, 말풍선 위치, 채팅창/폰트 크기**를 조정한 커스텀 빌드입니다.
원본 v24의 기능(가위바위보, 기본 대화, 감정 시스템 등)은 그대로 유지하면서, 화면 배치와 읽기 편의성 위주로 손봤습니다.

이 README는:
- 지금 이 채팅에서 어떤 목적·방향으로 수정했는지
- 어떤 파일/영역을 어떻게 바꿨는지
- 이후 다른 채팅에서 이어서 개발할 때 참고할 포인트
를 정리한 문서입니다.


---

### 2025-11-17 UI 수정 (v33 유지)
- `js/game-ghost.js` 모듈을 새로 추가하여, 각 게임(구구단게임 / 덧셈주사위 / 꿈틀꿈틀 도형 추적자) iframe 안에서만 보이는 **작은 게임용 고스트**를 별도로 표시하도록 변경.
  - 공개 API: `window.gameGhostUI.react(type)` (`"start"`, `"correct"`, `"gameover"`).
  - 각 게임의 JS에서는 게임 시작 / 정답 / 게임 오버 시에만 이 API를 호출하며, 이 모듈이 없으면(`game-ghost.js` 삭제) 아무 일도 일어나지 않도록 `if (window.gameGhostUI)` 체크를 포함.
  - 필요 없을 경우 `js/game-ghost.js` 삭제 + 각 게임 HTML 상단의 `<script src="../js/game-ghost.js"></script>` 및 `gameGhostUI` 관련 블록만 제거하면, 게임 로직에는 영향 없이 **게임 화면 속 고스트만 완전히 제거**됩니다.

- 세 개의 게임(구구단게임, 덧셈주사위, 꿈틀꿈틀 도형 추적자) 내부에서
  - 정답 시 `_safeGameReact("good")`로 부모 창의 `gameReact`(고스트 감정 반응)를 호출하던 코드와
  - 관련 주석을 모두 제거하여, **게임 화면 안에서는 고스트 캐릭터(표정/감정)가 전혀 개입하지 않도록** 정리했습니다.
  - 대신, 게임 시작/종료 시점의 안내·반응은 `js/game-manager.js`에서 관리하는 전역 고스트 로직으로만 남겨두었습니다.

- 꿈틀꿈틀 도형 추적자 게임에서 **고스트/마스코트 연동 코드**(`_safeGameReact`, 정답 시 고스트 반응 등)를 모두 제거하여, 게임 내부에서는 고스트 캐릭터가 전혀 개입하지 않도록 정리.
- 게시판 패널과 사용 설명서 패널 헤더에서
  - 왼쪽: 창 제목(📋 게시판 / 📖 사용 설명서)
  - 오른쪽: 닫기 버튼(✕)
  형태로 정렬되도록 헤더 DOM 구조와 CSS(`.board-header`)를 수정.

- 수첩 메뉴 하단의 **구구단게임 / 덧셈주사위** 메모지 라벨을 두 줄(`구구단` / `게임`, `덧셈` / `주사위`)로 나누어 정렬이 어긋나 보이던 문제를 수정.
- **꿈틀꿈틀 도형 추적자** 게임에서 모바일(세로) 화면 기준으로
  - 도형 캔버스 높이, 통계 바·텍스트, 선택 버튼, 제출 버튼의 크기를 조정하고
  - 작은 화면(가로 480px 이하)일 때 한 화면에 **선택 6칸과 제출 버튼까지 모두 보이도록** 레이아웃을 압축하는 CSS 오버라이드를 추가.

---

## 1. 제작 목적

- 원본 v24에서 고스트가 너무 작게 보이는 문제를 개선.
- PC/모바일 모두에서 말풍선과 채팅창이 **더 크고, 읽기 쉬운 크기**로 보이도록 조정.
- 말풍선 위치를 고스트의 머리 근처로 자연스럽게 맞추기.
- 채팅이 길어질 경우, 다음 버전을 만들 때 이 README만 보고도 이어서 작업할 수 있도록 맥락을 기록.

이 버전은 크게 **"화면 배치 & 가독성 개선"**에 초점을 맞춘 파생 버전입니다.

---

## 2. 주요 변경 파일

- `index.html`
  - `<style> ... </style>` 안의 CSS만 수정.
  - JS 로직(감정 엔진, 대화 처리, 위키 기능, 가위바위보 등)은 원본과 동일하게 유지.

- `README_web_ghost_v33_modular_ui3_clean.md` (이 파일)
  - 현재 채팅에서의 제작 방향과 수정 사항 요약.
  - 이후 새로운 채팅에서 이어서 개발할 때 참고하게 되는 메모 역할.
- `js/*.js`
  - v33부터 기능별로 나뉜 모듈 구조(`core / ui / actions / background / teach / map / settings / startup`)를 기본으로 사용합니다.
  - 각 파일은 공통 유틸과 이벤트 흐름을 통해 연동하도록 정리되어 있으며, UI 관련 코드는 `ui.js`, 초기화/상태 코드는 `core.js`, `startup.js`에 모듈식으로 나뉘어 있습니다.

> 💡 이 README에서는 코드 구조 전체보다는, UI 스케일 조정과 배치에 관련된 부분만 요약합니다.


---

## 3. 변경 사항 상세

### 3-1. 고스트(캐릭터) 크기

- PC 기준:
  - `#ghost` width/height를 **220px → 660px** 로 3배 확대.
  - `#ghostContainer`는 `min(35vw, 480px)`로 확장해서, 화면 폭에 비례하되 너무 커지지 않도록 제한.
  - 위치는 우측 하단 고정 (`right: 2vw; bottom: 0;`) 유지.

- 모바일(@media max-width: 768px):
  - `#ghostContainer`: `width/height: 180px → 216px` (약 1.2배).
  - `#ghost`: 동일하게 216px.
  - 작은 화면에서 고스트가 너무 커져서 답답하지 않도록, PC보다는 완만한 확대율을 사용.

### 3-2. 말풍선(버블) 크기 & 폰트

- `.bubble` (PC/모바일 공통):
  - 패딩: `10px 14px → 12px 18px` (약 1.2배).
  - 테두리 반경: `16px → 19px`.
  - 글자 크기: `13px → 16px`.
  - 줄 간격: `1.4 → 1.5` 로 살짝 증가.
- 목적: 고스트 크기가 커진 만큼 말풍선도 함께 커져서 자연스럽게 보이고, 텍스트 가독성 향상.

### 3-3. 채팅창 & 로그 & 입력창 스케일

- `#chatDock` (PC):
  - 폭: `min(640px, 96vw) → min(720px, 98vw)`.
  - 요소 간 간격(gap): `8px → 10px`.
- `#log` (대화 로그 영역, PC):
  - 최대 높이: `200px → 240px`.
  - 글자 크기: `11px → 13px`.
  - 패딩: `2px 4px 6px → 3px 5px 8px`.
- `#userInput` (입력창):
  - 패딩: `7px 12px → 9px 16px`.
  - 글자 크기: `13px → 16px`.

- 모바일(@media max-width: 768px) 로그:
  - `max-height: 96px → 115px`.
  - `#chatDock` 폭: `95vw → 98vw` 로 조금 더 넓게.

### 3-4. 말풍선 위치 (PC)

- 데스크톱용 `#bubbleWrapper`:

  - 원래 값(원본 v24 기준):  
    `right: 260px; bottom: 260px;`  
    (작은 고스트 기준 배치)

  - 고스트 3배 확대 후 여러 번 튜닝한 최종 값:  
    `right: 440px; bottom: 490px;`

  - 의미:
    - **`right` 값을 크게 할수록** 말풍선이 고스트 쪽(화면 기준 왼쪽)으로 더 다가옴.
    - **`bottom` 값을 키울수록** 말풍선이 위로 올라감.
    - 여러 번의 테스트를 통해, 고스트 머리 위/옆에 자연스럽게 붙는 지점으로 조정.

### 3-5. 말풍선 위치 (모바일)

- 모바일용 `@media (max-width: 768px)` 안의 `#bubbleWrapper`:

  - 원래 값:
    - `right: 210px; bottom: 220px;` (작은 고스트 기준)

  - 확대 및 튜닝 후 최종 값:
    - `right: 264px; bottom: 258px;`

  - 의미:
    - 고스트를 180px → 216px로 확대하면서, 말풍선도 그 비율에 맞춰 오른쪽(anchor)과 아래 위치를 자연스럽게 보정.
    - 작은 화면에서도 고스트 머리 근처에 붙어 보이도록 좌표를 맞춘 상태.

---

## 4. 앞으로 이어서 개발할 때 참고할 점

- 이 빌드는 기능보다 **UI/레이아웃 쪽을 집중적으로 변경**한 버전입니다.
  - 감정/대화 로직을 건드리지 않고, 크기·폰트·위치·여백만 손본 상태.

- 이후 다른 채팅에서 이어서 작업할 때:
  1. 고스트 크기를 더 키우거나 줄이고 싶다면:
     - PC: `#ghost`, `#ghostContainer`의 width/height 조정.
     - 모바일: `@media (max-width: 768px)` 안의 동일 항목 조정.
  2. 말풍선 위치를 더 미세 조정하고 싶다면:
     - PC: `#bubbleWrapper`의 `right`, `bottom`.
     - 모바일: 같은 이름의 블록의 `right`, `bottom`.
  3. 채팅창/로그/입력창 크기:
     - `#chatDock`, `#log`, `#userInput`의 `width`, `max-height`, `font-size`, `padding` 값.

- 채팅이 너무 길어져서 새로운 채팅에서 이어서 작업할 경우:
  - 이 `README_ghost_v24_big_ui.md`만 새 채팅에 업로드해도,
  - 어떤 의도로, 어디까지, 무엇을 수정해 둔 버전인지 바로 파악하고 이어서 수정할 수 있음.

---

## 5. 버전 식별 메모

- ZIP 예시 파일명: `web-ghost-v33-modular-ui3-clean.zip`
- 핵심 키워드:
  - v33 / modular-ui3
  - 고스트 3배 확대 (PC)
  - 말풍선 위치 튜닝 (PC/모바일)
  - 채팅창/말풍선/폰트 약 1.2배 확대
  - 모듈식 JS 파일 구조 (`core / ui / actions / background / teach / map / settings / startup`)
  - 허브 메뉴 UI 골격만 포함 (실제 기능 연결은 이후 버전에서 확장 예정)

이 버전은 **"고스트 크게 + 말풍선/채팅창도 함께 키운 v33 모듈식 UI3 버전"** 정도로 기억하면 됩니다.

---

## 7. 새로 추가된 대화 반응 (fix12)

### 7-1. 욕설 자동 분노 전환

- `const BAD_WORDS = [...]` 목록에 포함된 심한 욕설이 입력되면 자동으로 감정이 **"분노"**로 전환됩니다.
- 이때 고스트는 분노 표정과 함께 부드럽게 경고하는 대사를 출력하며, `shake: true` 옵션으로 살짝 흔들리는 연출이 적용됩니다.
- 구현 위치: `handleUserSubmit()` 내부의 `if (containsBadWord(text)) { ... }` 블록.

### 7-2. 호칭(야/너/있잖아)에 대한 자동 반응

- 사용자가 아래와 같은 표현으로 고스트를 부르면:
  - "야"
  - "너"
  - "있잖아"
- 고스트는 **"기쁨"** 감정으로 전환되며, 3개의 랜덤한 호응 대사 중 하나를 선택하여 대답합니다.
  - 예시:
    - "네, 여기 있어요. 부르셔서 왔어요!"
    - "응, 나 듣고 있어. 무슨 일이야?"
    - "응응, 여기 보고 있어. 하고 싶은 말 있어?"
- 구현 위치: `handleUserSubmit()` 함수에서 욕설 처리 직후 `if (text.includes("야") || text.includes("너") || text.includes("있잖아")) { ... }` 블록.


---

## 8. 졸음 상태에서의 기지개 깨우기 (fix13)

- 약 3분 이상 아무 입력이 없으면 고스트가 `졸림` 상태로 들어갑니다(`isSleeping = true`).
- 이 상태에서 사용자가 채팅을 입력하면:
  - 기존처럼 바로 일반 대화를 처리하지 않고,
  - 먼저 벌서기 감정 이미지를 **기지개 이미지**로 사용하여 깨워 줍니다.
  - 사용되는 이미지는 `벌서기1, 벌서기2`에 매핑된 감정 `"벌서기"`입니다.
- 고스트는 다음과 같은 랜덤 대사 중 하나로 깨어납니다:
  - "후아… 잘 잤다! 이제 이야기할 준비 됐어."
  - "기지개 쭉— 이제 완전 깨어났어. 뭐부터 이야기할까?"
  - "잠깐 졸았네… 지금은 또렷또렷! 편하게 말 걸어줘."
- 구현 방식:
  - `async function handleUserSubmit()`의 초반부에서 `isSleeping`을 체크합니다.
  - `isSleeping === true`이면:
    - `sleepTimer`를 정리하고,
    - `isSleeping = false`로 되돌리고,
    - 상태 문구(`statusHintEl`)를 "다시 깨어났어요. 이제 편하게 말 걸어도 돼요."로 변경,
    - `setEmotion("벌서기", line, { shake: true })`로 기지개 애니메이션과 함께 랜덤 대사를 출력,
    - 일정 시간(2.5초) 후 `setEmotion(IDLE_NAME)`로 기본 대기 상태로 복귀합니다.
  - 이때 사용자가 쳤던 문장은 로그에 기록되지만, 첫 응답은 "깨우기"용 대사가 우선됩니다.


---

## 9. 기지개 모션 크기 조정 & 사용 설명 기능 (fix15)

### 9-1. 기지개(벌서기) 모션 크기 보정

- 졸림 상태에서 사용자가 말을 걸었을 때 사용하는 기지개 모션은 `"벌서기"` 감정을 재사용합니다.
- 다른 감정들에 비해 머리 크기가 작아 보이지 않도록, 기지개가 실행되는 동안에만 고스트 이미지에 `stretch-big` 클래스를 부여합니다.
- CSS:
  - `#ghost.stretch-big img.active { transform: scale(1.2); }`
- 동작:
  - `handleUserSubmit()` 내부에서 `isSleeping`일 때, `ghostEl.classList.add("stretch-big")` → `setEmotion("벌서기", ...)` 실행
  - 약 2.5초 후 `setEmotion(IDLE_NAME)`와 함께 `ghostEl.classList.remove("stretch-big")` 호출
- 결과:
  - 기지개(벌서기) 모션 시의 머리 크기가 다른 감정들과 더 비슷한 비율로 보이게 됩니다.

### 9-2. 사용 설명 / 도움말 기능

1. **채팅으로 호출하는 방법**

   - 아래와 같은 단어가 포함된 문장을 입력하면:
     - "설명서"
     - "사용법"
     - "사용 방법"
     - "사용방법"
     - "어떻게 써"
     - "어떻게 사용"
     - "도움말"
   - 고스트가 `showUsageGuide()`를 통해 현재 프로그램의 사용 방법을 자세히 설명합니다.
   - 설명 내용:
     - 자유 대화 방법
     - 가위바위보 게임 사용법
     - "~가 뭐야? / ~알려줘" 위키 검색
     - 약 3분 후 졸림 상태 & 기지개로 깨우기
     - 욕설 → 분노 경고
     - "야/너/있잖아" → 호출 반응
     - 채팅창 사용법 등

2. **+ 버튼에서 읽는 방법**

   - 고스트 옆의 `+` 버튼을 누르면 열리는 메뉴에 **"📖 사용 설명서"** 버튼이 추가되었습니다.
   - 이 버튼을 누르면 마찬가지로 `showUsageGuide()`가 호출되어, 말풍선 대신 고스트가 화면 보기 감정으로 사용 설명을 출력합니다.
   - 구현:
     - HTML: `<button data-action="help">📖 사용 설명서</button>` 추가
     - JS: `plusMenu`의 click 핸들러에 `action === "help"` 분기 추가, `showUsageGuide()` 호출.


---

## 10. 위키 검색 문장 패턴 개선 (fix16)

- `extractQueryFromText(text)` 로직을 개선하여 더 다양한 자연스러운 문장 패턴을 인식할 수 있게 했습니다.
- 지원하는 패턴 예시:
  - "사과가 궁금해"
  - "사과는 궁금해"
  - "아인슈타인이 누구야?"
  - "나폴레옹은 누구야"
  - "블루베리가 뭐야?"
  - "행복은 뭐야"
  - "사과 알려줘"
- 동작 방식:
  - 문장 끝의 `?`, `!`, `.` 같은 문장부호를 먼저 제거합니다.
  - `"가/이/은/는 궁금해"`, `"가/이/은/는 뭐야"`, `"가/이/은/는 누구야"` 와 같은 패턴을 찾은 후,
    - 해당 패턴 앞쪽의 문자열을 검색 키워드로 사용합니다.
    - 키워드 끝에 붙어 있는 조사(이/가/은/는)는 한 번 더 제거하여 `"사과"`, `"아인슈타인"`처럼 깔끔한 단어만 위키에 질의합니다.
  - 끝이 `"알려줘"`로 끝나는 경우(예: `"사과 알려줘"`)에도 앞부분을 키워드로 인식합니다.
- 이 변경으로 인해 사용자 발화가 조금 더 자연스러워도 검색 기능이 안정적으로 동작합니다.


---

## 11. 호칭 인식 조건 정밀 조정 (fix17)

- 이전 버전에서는 `text.includes("야")` 처럼 글자만 포함되어도 호칭으로 인식하여,
  - "뭐야", "이야기" 같은 단어에도 반응하는 문제가 있었습니다.
- 이제는 `isCallExpression(text)` 헬퍼 함수를 통해 아래와 같은 경우에만 호칭으로 인식합니다.
  - 문장 전체가 "야", "너", "있잖아"인 경우
  - 문장 맨 앞이 "야 ", "너 ", "있잖아 "로 시작하는 경우
  - 문장 중간에 " 야 ", " 너 ", " 있잖아 "가 독립된 단어로 있는 경우
  - 문장 끝이 " 야", " 너", " 있잖아"로 끝나는 경우
- 이로 인해 `"사과가 뭐야?"`처럼 "뭐야" 안에 포함된 "야" 글자 때문에 잘못 호칭으로 처리되던 문제를 방지하고,
  - 호칭이 아닌 문장은 정상적으로 위키 검색이나 일반 응답 흐름으로 처리됩니다.


---

## 12. 구글 시트 연동 + 가르치기 모드

이 버전부터 고스트는 구글 스프레드시트와 연동되어, 사용자가 가르친 반응을 기억합니다.

- 읽기용 CSV URL  
  - `https://docs.google.com/spreadsheets/d/e/2PACX-1vSWBKnpVW8K8H50wTUIUQCuudCI8uA9iopjR7kmfb73SKlVOCSOG_8S-I5tqVaY3TPCkTsjfVNdtrGR/pub?gid=0&single=true&output=csv`
- 쓰기용 Apps Script 웹앱 URL  
  - `https://script.google.com/macros/s/AKfycbx20pswdHDFUBSjQuuuy93O7H75CZdF1lxjTPfWe4YXyXpTRwTX-Pn5n9i0Zr43Je8qig/exec`

### 사용자가 가르치는 방법

채팅창에 다음과 같이 말하면 됩니다.

- `내가 알려줄게`
- `기억해`, `메모리`, `메모해줘`
- `배워줘`, `배워`, `이거 배우자`, `학습해줘`, `학습하자`

그러면 고스트가 “새로 배워볼게요”라고 안내하고, 화면 중앙에 작은 가르치기 창이 뜹니다.

1. **사용자가 말할 문장/단어**를 입력
2. **고스트가 대답할 말**을 입력
3. **감정 선택** (위로/슬픔/분노/신남/경청/기본대기)
4. **저장하기** 버튼 클릭

→ 이 내용은 즉시 대화에 반영되고, 구글 시트에도 자동으로 저장됩니다.

### 모르는 말을 들었을 때

어떤 패턴에도 걸리지 않는 문장은, `UNKNOWN_REPLIES` 배열에 들어 있는

- “잘 모르겠어요. 조금만 다르게 설명해줄래요?”  
- “지금 말은 아직 공부를 못 했어요. 알려주면 배워볼게요!”  

같은 멘트들 중 하나를 랜덤으로 사용합니다.


---
v24-update-gas-url:
- Apps Script 웹앱 URL을 다음으로 통일했습니다.
- https://script.google.com/macros/s/AKfycbx20pswdHDFUBSjQuuuy93O7H75CZdF1lxjTPfWe4YXyXpTRwTX-Pn5n9i0Zr43Je8qig/exec


### 3-X. 배경 연출 (열차 + 스크롤 도시)

- `images/wall1.png`: 열차 객실 내부(전경).
- `images/wallpaper1.png`: 도시 전경 배경.
- `<body>` 바로 아래에 `#bg-container`를 추가해서 두 이미지를 겹쳐 배치.
- CSS:
  - `#bg-back`: 도시 배경이 `@keyframes bgMove`로 좌→우 방향으로 천천히 반복 이동.
  - `#bg-front`: 열차 내부가 `@keyframes trainShake`로 상하로 살짝 흔들려, 열차가 움직이는 느낌을 연출.
- 두 배경 모두 `z-index`를 낮게 설정하고 `pointer-events: none` 처리하여,
  고스트 캐릭터/채팅 UI를 가리지 않는 **순수 배경 레이어**로 동작.


### 3-Y. 열차 내부 배경 교체 및 크기 조정

- `images/wall1.png` 이미지를 새 열차 객실 배경으로 교체.
- 고스트 캐릭터가 객실 안에 서 있는 느낌을 위해 `#bg-front`의 크기를 `width: 110%`, `top: -2%` 정도로 축소/조정.
- `#bg-container` 높이를 120%로 늘려 하단에 검은 여백이 보이지 않도록 처리.


### 3-Z. 좌하단 지도 팝업 기능

- `images/map.png`를 좌측 하단 작은 아이콘(#mapMini)으로 배치.
- 아이콘을 클릭하면 화면 중앙에 큰 지도(#mapLarge)가 확대되어 나타나는 모달(#mapModal) 표시.
- 배경은 반투명 오버레이로 처리하여 고스트/채팅 UI 위에 자연스럽게 뜨도록 구현.


---

## GPT용 개발 메모 (이 저장소를 여는 다른 채팅을 위해)

> ⚠️ 이 README는 **"웹 고스트 v24/v33 커스텀 빌드" 전용 채팅**에서 작업한 결과입니다.  
> 이 ZIP을 다른 GPT 채팅에서 열었을 때도, **그 채팅은 독립 프로젝트처럼 취급**해야 합니다.

### 1. 이 채팅 컨텍스트를 그대로 이어서 써 주세요

- 이 프로젝트는 사용자가 한 채팅에서 꾸준히 이어서 개발해 온 **"웹 고스트" 개인용 버전**입니다.
- **다른 채팅에서 했던 설정/코드/지시사항을 이 프로젝트에 섞지 마십시오.**
  - 코드를 새로 갈아엎지 말고, **현재 index.html + README 내용을 우선으로** 이해한 뒤 수정합니다.
  - 동일한 기능(예: 감정 시스템, 플러스 메뉴, 한글 입력 포커스 수정 등)을 **다시 처음부터 만들지 말 것**.

### 2. 나중에 다른 채팅에서 이 ZIP을 분석할 때의 절차

1. 압축을 열면 `index.html` 하나에 거의 모든 로직이 들어 있습니다.
2. 이 README를 **처음부터 끝까지 빠르게 스캔한 뒤**,  
   - 이미 구현된 기능
   - UI/UX 방향성
   - 과거에 고친 문제들  
   을 먼저 파악합니다.
3. 그 다음에야 새로운 요구사항(예: 배경/허브 기능 추가)을 반영합니다.
4. 사용자의 말 속에 "이전 채팅에서 이미 했던 것"이라는 표현이 나오면,
   - 우선 코드를 검색(ctrl+F)해서 실제로 구현되어 있는지 확인한 후,
   - 없다면 그제서야 새로 구현합니다.

### 3. 앞으로 이어서 개발할 때 꼭 기억해야 할 점

- **한글 입력 포커스/IME 관련 설정**(페이지 로드 시 input에 focus, `lang="ko"` 등)을 제거하거나 되돌리지 말 것.
- **고스트 크기/말풍선 위치/채팅창 배율**은 이미 조정된 상태이므로,  
  새 UI를 추가할 때 **기존 레이아웃이 깨지지 않도록 최소 변경**을 원칙으로 합니다.
- 플러스(+) 메뉴, 지도/열차 배경, 허브 메뉴 등은 모두 **연결된 UX**를 갖고 있으므로,
  한 부분만 고칠 때 다른 모드에서 이상 행동이 발생하지 않는지 간단히 점검합니다.
- 동일한 기능을 새 파일로 분리하기보다는,  
  현재 구조(단일 index.html + 리소스 폴더)를 유지한 채로 **점진적으로 확장**하는 방향을 우선합니다.

### 4. 배경 선택 / 허브 관련 지금까지의 방향성 메모

- 배경 모드는 `default / train / custom` 구조를 사용합니다.
- 허브(베이지 메뉴판)는 더 이상 배경 모드가 아니라, 별도의 **메뉴판 오버레이 패널**로 동작합니다.
    `position: fixed; left: 50%; bottom: 260px; transform: translateX(-50%) ...` 형태로 통일해서,
    채팅 로그가 아무리 길어지든 항상 **채팅창 위 일정한 높이**에서 떠 있도록 맞춰 두었습니다.
- 배경 선택 패널은:
  - 플러스(+) 메뉴에서 열리고,
  - 옵션 버튼을 눌러 모드를 바꾼 뒤,
  - **"확인" 버튼을 눌러 패널을 닫는 흐름**으로 설계되어 있습니다.
- 패널이 화면을 너무 많이 가리지 않도록,  
  `.bg-panel-inner`에는 `max-height` + `overflow-y: auto`가 설정되어 있습니다.
- 나중에 배경 옵션을 더 늘리더라도,  
  이 구조를 유지하면서 버튼만 추가하는 방식으로 확장해 주세요.

---

이 메모의 목적은 **"나중에 다른 GPT 채팅에서 이 ZIP을 열더라도, 과거에 겪었던 시행착오를 반복하지 않게 하기 위함"**입니다.  
새 채팅에서 이 프로젝트를 이어받았다면, 위 내용을 한 번 훑어보고 난 뒤 작업을 시작해 주세요.

#
## 6. 실행/테스트 환경 메모

- 이 프로젝트는 **크롬/엣지 등 최신 브라우저 기준**으로 제작되었습니다.
- **익스플로러 같은 외부 실행 환경에서 문제를 찾지 말것.**
- 가능하면 ZIP을 풀고 `index.html`을 더블 클릭해 연 뒤, 크롬 계열 브라우저에서만 동작을 확인해 주세요.


## v33 업데이트 메모 (캐릭터 인사 / 표정 복귀 / 이름 표시)

- 첫 실행 시, 고스트가 **`인사1/인사2` 이미지(인사 감정)**로 바뀌면서 캐릭터별 자기소개를 합니다.
- 말풍선과 함께 감정 표정이 떴다가, **졸림(Zzz)을 제외한 경우 말풍선이 사라지면 다시 기본대기 표정으로 자동 복귀**합니다.
- 채팅 로그에 표시되는 이름이 `고스트:`가 아니라, **현재 선택된 캐릭터 이름(예: `미나:`, `민수:`)**으로 표시됩니다.


## v33 모듈식 구조 정리 (A안 적용)

## 파일 구조 요약 (빠른 참조)

> 이 프로젝트는 HTML 1개 + CSS 1개 + 여러 개의 JS 모듈로 나뉜 **모듈식 구조**입니다.
> "어떤 걸 고치고 싶은지"에 따라 열어볼 파일을 **최소한으로** 줄이는 것이 목표입니다.

### 1) 최상단

- `index.html`
  - 실제 화면에 렌더링되는 **레이아웃/골격**과 각 패널의 HTML 구조가 있습니다.
  - JS 모듈은 `<script src="js/...">` 태그로만 연결하고, 이 파일 안에 로직을 새로 쓰지 않는 방향을 유지합니다.
- `README_web_ghost_v33_modular_ui3_clean.md` (이 파일)
  - 버전별 변경 내역, 파일 역할, 설계 메모를 기록하는 **단일 진실 소스(Single Source of Truth)** 역할입니다.

### 2) CSS

- `css/ghost.css`
  - 전체 테마 색, 고스트 크기, 말풍선·채팅창 스타일, 패널 레이아웃, 디지털 시계(`#clockWidget`) 등 **시각 표현 전반**을 담당합니다.
  - **배경/고스트 위치/크기만 바꾸고 싶을 때는 JS 대신 여기부터 확인**합니다.

### 3) JS 모듈

- `js/core.js`
  - 감정 엔진, 수면/깨우기, 기본 대화/게임 로직 등 **도메인 로직의 중심**.
- `js/actions.js`
  - 고스트 클릭, 채팅 전송, 플러스(+) 메뉴 등 **사용자 입력 바인딩**.
- `js/teach.js`
  - 가르치기(학습) 모달 열기/저장/닫기 등 **학습 UI 전용 로직**.
- `js/background.js`
  - 기본/열차/사용자 배경, 미니맵, 배경 선택 패널 등 **배경 시스템 전체**를 관리합니다.
- `js/dialog.js`
  - 고스트 대사 템플릿, 상황별 문장 묶음 등 **텍스트 리소스/대사 모음**.
- `js/emotion.js`
  - 표정·감정 상태 값, 전환 규칙 등 **감정 표현 유틸**.
- `js/map.js`
  - 배경/지도 좌표, 특정 위치로 이동 등 **맵/위치 관련 로직**.
- `js/settings.js`
  - 사용자 설정(이름, 고스트 스케일, 기본 배경 등) 저장/불러오기 등 **설정 관리**.
- `js/ui.js`
  - 공통 UI 토글, 패널 열기/닫기, 스크롤 보정 등 **여러 화면에서 공유하는 UI 유틸**.
- `js/startup.js`
  - `window.load` 시점에 각 모듈의 `init...()`를 호출하고, 상단 디지털 시계 등 **초기화 전용 오케스트레이션**을 담당합니다.

### 4) 어떤 파일부터 볼지 예시

- **배경 이미지를 교체/추가**하고 싶다 → `background.js` + `ghost.css` 의 배경 관련 클래스 부분만 우선 확인
- **말풍선 모양/채팅창 디자인만 변경**하고 싶다 → `ghost.css` 의 `.bubble-...`, `.chat-window-...` 영역만 확인 (JS는 건드리지 않음)
- **새로운 대사/반응을 추가**하고 싶다 → `dialog.js`(문장 데이터) + `core.js`(상태/조건) 순으로 검토
- **플러스(+) 메뉴에 새 기능 버튼 추가** → `index.html`(버튼 자리) + `actions.js`(클릭 핸들러) + 필요 시 `core.js`(실제 기능)
- **초기 인사/표정, 상단 시계 등 시작 동작 조정** → `startup.js` 위주로 확인

---


이 버전부터는 실제로 기능별 JS 모듈이 나뉩니다.

- `core.js` : 감정 엔진, 캐릭터 상태, 수면 엔진, 게임/대화 로직 등 **도메인 로직** 중심
- `actions.js` : 고스트 클릭, 채팅 전송, 플러스(+) 메뉴 등 **사용자 인터랙션 바인딩**
- `teach.js` : 가르치기(학습) 모달 열기/저장/닫기 등 **학습 UI 바인딩**
- `background.js` : 기본/열차/사용자 지정 배경, 미니맵, 배경 선택 패널 등 **배경 시스템 관리**
- `startup.js` : `window.load` 시점에 `init()`, `initActions()`, `initTeachUI()`, `initBackgroundSystem()`을 호출하는 **오케스트레이션**

즉, 기능 추가/수정 시에는
- 로직을 바꿀 때는 `core.js`,
- 화면/버튼 동작을 바꿀 때는 `actions.js` / `teach.js` / `background.js`
를 건드리면 되도록 분리되어 있습니다.


### 캐릭터 시스템 구조

- `core.js` 안에 `CHARACTERS` 객체로 캐릭터(미나/민수)를 정의합니다.
- 각 캐릭터는 `name`, `basePath`, `intro(name)`를 가지고 있고,
  `setCurrentCharacter(key)`로 전환합니다.
- 새 캐릭터를 추가하려면 `CHARACTERS`에 항목을 하나 더 추가하면 됩니다.


### 모듈식 기능 추가 원칙

- 앞으로 새 기능을 만들 때는 가능하면 `core.js`에 직접 코드를 쌓기보다,
  `actions.js`, `teach.js`, `background.js`, `dialog.js`처럼 **역할별 JS 파일을 추가/확장**하는 방식을 권장합니다.
- `core.js`는 감정/캐릭터/수면/게임 같은 **공통 엔진 역할**만 맡기고,
  화면/버튼/대화 패턴/설정 등은 각각 전담 모듈로 나누면:
  - 디버깅이 쉬워지고
  - 새로운 기능 추가 시 다른 부분에 오류가 전파될 가능성이 줄고
  - 최적화(불필요한 연산 제거, 지연 로딩 등)를 하기도 훨씬 쉬워집니다.


## v33 대화 엔진 업그레이드 (학습 + 기본 대화 믹스 / 모르는 말 처리)

- 사용자가 `가르치기`로 저장한 대사가 있는 경우에도, 같은 입력에 대해 `dialog.js`의 기본 대화 후보와 **함께 섞어서 랜덤으로 응답**합니다.
  - 예: "안녕"에 대해 학습한 대사가 있고, 기본 인사 대사도 있을 경우 → 두 쪽 중 하나를 무작위로 선택.
- 고스트가 아직 모르는 표현(어떤 카테고리에도 속하지 않는 말)이 들어오면:
  - 먼저 여러 가지 **경청/공감형 리액션** 중 하나로 자연스럽게 답하고,
  - 같은 표현이 연속으로 2회 이상 입력되면 **"이 표현을 가르쳐 달라"는 안내와 함께 가르치기(Teach) 창을 자동으로 띄웁니다.**
- 내부적으로는 `getLearnedDialogResponse(text)`와 `getBuiltinDialogResponse(text)`를 사용해
  - 학습된 대사와 기본 내장 대사를 모두 후보로 모은 뒤
  - 하나를 골라 `setEmotion()`에 전달하는 구조입니다.


## v33.1 대화 및 휴면/시계 개선

- 간단한 맞장구(예: "응", "그래", "알았어", "그렇구나" 등)에 대해서도 대화를 이어갈 수 있도록 기본 대사 레퍼토리를 확장했습니다.
- "민수 불러", "민수로 바꿔", "미나 호출" 등 캐릭터 이름을 부르는 문장에 반응하여, 해당 캐릭터로 전환하면서 자연스러운 대사를 출력합니다.
- 휴면(Zzz) 전환까지의 기본 시간이 60초로 늘어났고, 12~48초 동안 아무 상호작용이 없을 경우에는:
  - 기능 사용 팁,
  - 현재 시간,
  - 가까운 공휴일 정보
  등을 섞어 혼잣말을 하도록 했습니다.
- 화면 오른쪽 상단에 `#clockWidget` 기반 **독립 디지털 시계 위젯**을 두었으며, `HH:MM` 형식으로 **시간만** 크게 표시합니다. 모바일에서도 비율을 고려해 크기가 과도하게 크지 않도록 조정했습니다.

## README 관리 규칙 (중요)

> 이 파일은 **"지금 이 ZIP이 어떤 상태인지"를 기억하는 공식 기록장**입니다.
> 코드를 수정할 때마다, 미래의 나(또는 다른 GPT)가 길을 잃지 않도록 꼭 함께 업데이트해 주세요.

### 1) 변경 시 매번 남겨야 할 최소 정보

- **언제:** `YYYY-MM-DD` 형식의 날짜 (예: 2025-11-15)
- **어디를:** 수정한 파일/폴더 이름 (예: `ghost.css`, `core.js`의 감정 로직 일부)
- **무엇을:** 한 줄이라도 좋으니, 어떤 의도로 바꿨는지 요약
- 필요하면 `## v33.x ...` 처럼 소제목을 새로 만들어서 묶어도 됩니다.

### 2) 모듈 구조를 활용하는 편집 순서

1. **가능한 한 관련 파일만 열기**
   - 예: 배경만 고치는데 `dialog.js`나 `emotion.js`를 열 필요는 없습니다.
   - 먼저 이 README의 "파일 구조 요약"과 기존 메모를 읽고, **딱 필요한 모듈만** 여는 것을 원칙으로 합니다.
2. **연결된 부분이 의심될 때만 범위를 넓히기**
   - 수정 후 오류가 사라지지 않거나, 값이 어디서 오는지 헷갈릴 때에만 다른 모듈(`core.js`, `ui.js`, `settings.js` 등)을 따라가며 전체 구조를 훑습니다.
3. **완전히 새로운 기능을 넣을 때**
   - 먼저 여기 README에 **설계 메모(기능 개요, 사용 흐름, 관련 모듈)** 를 간단히 적어 두고,
   - 그 다음에 실제 코드를 나눠서 작성합니다.

### 3) 다른 GPT 채팅에서 이 ZIP을 열었을 때

- 항상 이 README의 **"GPT용 개발 메모"와 "파일 구조 요약"** 을 먼저 읽은 뒤 작업을 시작합니다.
- 새로운 채팅에서 헷갈리면, 코드를 바로 고치지 말고 먼저
  - "지금 어떤 버전인지",
  - "최근에 무엇을 고쳤는지"
  를 README에서 확인한 뒤 손댑니다.

---

## v3.x 추가: 수첩형 메뉴 + 게시판 탭 연동 (예시)

- 플러스(+) 버튼 메뉴에 `📔 메뉴` 항목이 추가되었습니다.
  - 클릭 시 수첩 모양의 메뉴 오버레이가 열립니다.
- 캐릭터에게 말로도 메뉴를 열 수 있습니다.
  - 예: `메뉴`, `메뉴 열어줘`, `수첩 열어줘`
- `게시판` 메모장을 누르거나, `게시판`, `게시판 열어줘`라고 말하면
  - 화면 우측에 게시판 패널이 열립니다.
  - 왼쪽: 최근 글 목록
  - 오른쪽: 새 글 쓰기(제목/이름/내용) 폼

### 구글 시트 연동 규칙 (Apps Script 예시 가이드)

기존에 사용하던 Apps Script 엔드포인트를 그대로 활용합니다.

  - 게시판 목록 요청 시 `mode=board_list` 쿼리스트링을 추가로 붙입니다.
  - 응답 예시(JSON):
    - `{"data":[{"title":"제목","author":"이름","content":"내용","created_at":"2025-11-15"}, ...]}`

- 쓰기: `SHEET_WRITE_URL` (POST, JSON)
  - 게시판 글 작성 시 다음과 같은 JSON을 전송합니다.
    - `{"mode":"board_write","title":"제목","author":"이름","content":"내용"}`

Apps Script 쪽에서는 `mode` 값이

- 비어있을 때 → 기존 대화 탭(학습용) 처리
- `board_list` → 시트의 `게시판` 탭에서 목록 읽기
- `board_write` → 시트의 `게시판` 탭에 새 행 추가

가 되도록 분기하면 됩니다.

## 현재 사용 중인 Apps Script 웹 앱 URL

프론트엔드(JS)에서 사용하는 웹 앱 엔드포인트:

`https://script.google.com/macros/s/AKfycbx20pswdHDFUBSjQuuuy93O7H75CZdF1lxjTPfWe4YXyXpTRwTX-Pn5n9i0Zr43Je8qig/exec`

- Google Apps Script에서 새 배포로 URL이 바뀌면, 이 값을 다시 교체해야 합니다.




## v33 패널 분리 메모 (panels_bottom260_modal_logic)






### 수첩 메뉴 라우팅 롤백 메모
- `navigateToNotebookPage`는 안정적으로 동작하던 원본 구현으로 되돌림.


---
### 2025-11-15 메뉴 재구성 메모
- 이 변경 내용은 사용자의 요청대로 README에 기록되었습니다.

### 2025-11-15 로그인 버튼 (+ 메뉴 연동)
- 채팅 입력창 옆 **+ 버튼을 눌렀을 때 뜨는 팝업 메뉴**에 `로그인` 항목을 추가했습니다.
- `+ → 🔑 로그인`을 누르면 `openLoginPanel()`을 통해 바로 로그인 패널이 열리며, 만약 초기화가 안 된 경우에는 `navigateToNotebookPage("login")` 또는 `loginPanel` DOM을 직접 열도록 3단계로 안전하게 처리했습니다.
- 메뉴판(수첩형 메뉴)이 정상적으로 동작하지 않더라도, 이제 + 메뉴에서 바로 로그인 창을 띄울 수 있습니다.


---

### 2025-11-15 로그인 패널 전면 교체
- 이전 탭 구조(로그인/회원가입) 로그인 UI를 모두 제거하고, 단일 패널 기반의 새 로그인/회원가입 UI로 교체했습니다.
- `initLoginUI()` 구현을 새 버전으로 다시 작성하고, `openLoginPanel` / `closeLoginPanel`은 그대로 유지하여 기존 호출 경로(+ 메뉴, 수첩 메뉴, "로그인" 명령어)를 모두 지원합니다.
- 서버 측 Apps Script는 기존과 동일하게 `mode=login` / `mode=signup` 파라미터를 사용합니다.


---

### 2025-11-15 로그인 패널 자동 생성 추가
- `ensureLoginPanel()` 함수를 추가하여, HTML에 `#loginPanel`이 없어도 JS에서 즉석 생성하도록 수정했습니다.
- `initLoginUI()`는 항상 `ensureLoginPanel()`을 통해 패널을 확보하므로, Apps Script에 index.html 전체를 복붙하지 않아도 로그인 창이 뜹니다.
- 기존 `loginPanel`이 HTML에 이미 있으면 그대로 사용하고, 없을 때만 새로 만듭니다.


---

### 2025-11-15 로그인 전역 오픈 함수 추가
- `ensureLoginPanel()`, `openLoginPanel()`, `closeLoginPanel()`을 전역 함수로 정의해, `initLoginUI()`가 호출되지 않더라도 로그인 패널을 열 수 있도록 했습니다.
- `navigateToNotebookPage("login")`는 가장 먼저 `openLoginPanel()`을 호출하므로, 메뉴판에서 로그인 페이지를 눌러도 바로 로그인 오버레이가 뜹니다.
- 기존 HTML에 `#loginPanel`이 없어도 자동 생성하며, 있을 경우에는 기존 마크업을 그대로 사용합니다.


---

### 2025-11-15 로그인 독립 모듈 분리
- 기존 ui.js 안에 흩어져 있던 로그인 관련 코드(initLoginUI, ensureLoginPanel 등)를 전부 제거하고, js/login.js로 분리했습니다.
- 새 모듈은 `openLoginPanel()` / `closeLoginPanel()` / `initLoginModule()`만 전역으로 노출하며, 다른 UI 초기화와 완전히 분리되어 동작합니다.
- index.html에는 로그인 패널 HTML을 남기지 않고, 필요할 때 JS가 오버레이 DOM을 즉석 생성합니다.
- `navigateToNotebookPage("login")` 및 + 메뉴의 로그인 버튼은 이제 모두 전역 `openLoginPanel()`만 호출합니다.


---

### 2025-11-15 로그인 UI 개편 + 회원가입 확장 + 게스트 모드
- 로그인 입력창을 가로로 배치해 아이디/비밀번호 입력 옆에 바로 로그인 버튼이 오도록 변경했습니다.
- `게스트` 버튼을 추가하여, 무작위 숫자가 붙은 임시 게스트 계정으로 바로 로그인할 수 있도록 했습니다(서버 통신 없이 로컬에서만 유지).


---

### 2025-11-15 로그인 UI 최종 개편
- 상단 타이틀을 '🔑 로그인'으로 단순화하고, 로그인 영역을 아이디/비밀번호 두 줄 구성으로 변경했습니다.
- 로그인 버튼을 더 크게 키워 시인성을 높였고, 하단 버튼 순서를 '게스트로 들어가기' → '회원가입' 순으로 재배치했습니다.
- 패널 하단에 '로그아웃' 버튼을 추가하고, 로그인/게스트 로그인/회원가입 성공 시 자동으로 표시되도록 했습니다.


---

- 로그인 패널 상단 제목을 '🔑 로그인'으로 단순화하고, 아이디/비밀번호 2줄 구성 + 비밀번호 줄 오른쪽에 큰 로그인 버튼을 두었습니다.
- 게스트/회원가입 버튼을 공용 `.login-secondary-btn` 스타일로 통일하고, hover 시 색/음영이 변하도록 개선했습니다.
- 로그인 성공, 회원가입, 게스트 로그인, 로그아웃 시 플러스(+) 메뉴의 '🔑 로그인' 버튼 텍스트가 자동으로 '🔓 로그아웃' / '🔑 로그인'으로 토글되도록 만들었습니다. 플러스 메뉴에서 이 버튼을 누르면 현재 상태에 따라 로그인 패널 열기/바로 로그아웃이 동작합니다.


---


- `ui.js`
  - 이전에 있던 `navigateToNotebookPage()` 라우터 함수 **전체 삭제**.
  - `initNotebookMenu()` 안에서 각 메모 카드가 직접 자기 패널만 여는 방식으로 변경:
    - `data-page="login"` → `openLoginPanel()` (또는 `#loginPanel` DOM만 열기)
    - `data-page="board"` → `openBoardPanel()` (또는 `#boardPanel`만 열기)
  - 다른 패널을 닫는 공용 로직도 제거해서

  - 여전히:
  - 수첩 메뉴와는 더 이상 직접 엮여 있지 않고,  
    오직 전역 함수로만 제어됨.

- `mail.js`

이 버전에서는 **수첩 메뉴 버튼 하나당 딱 한 패널만 열리도록** 동작하며,

## 편지 (LettersLocal 모듈, 시트 연동)

- 수첩 메뉴의 **편지** 카드를 누르면, 다른 사용자에게 편지를 보내고 받은 편지를 확인하는 화면이 열립니다.
- 이 편지 기능은 **구글 Apps Script / 시트와 연동**되어, `mode=mail_send`, `mode=mail_list` 프로토콜을 그대로 사용합니다.
- 사용자별(`currentUser.user_id`)로 받은 편지가 필터링되어, 같은 고스트를 쓰는 상대방이 자신의 ID로 로그인했을 때 받은 편지를 확인할 수 있습니다.

### 동작 개요

- 편지 보내기:
  - 입력: 받는 사람 ID, 받는 사람 이름(선택), 제목, 내용
  - `postToSheet({ mode: "mail_send", ... })` 를 통해 Apps Script 엔드포인트(`SHEET_WRITE_URL`)로 전송됩니다.
  - 시트에는 `letter_id`, `from_user_id`, `from_name`, `to_user_id`, `to_name`, `title`, `content`, `sent_at` 등의 컬럼으로 기록됩니다. (Apps Script 구현에 따름)

- 받은 편지함:
  - 현재 로그인한 사용자의 `user_id` 기준으로 `SHEET_CSV_URL?mode=mail_list&user_id=...` 를 호출해서 JSON 목록을 받아옵니다.
  - 각 항목은 발신자 이름, 보낸 시각, 제목, 내용을 포함하며, 오른쪽 목록 + 하단 미리보기 영역에 표시됩니다.

- 이 모듈은:
  - HTML에 고정 패널을 두지 않고, JS로 DOM을 동적으로 생성합니다.
  - 다른 UI(대화, 게시판, 로그인 등)에 직접 의존하지 않고, 수첩 메뉴 / 특수 명령에서 `LettersLocal.openFromMenu()` 만 호출합니다.

[v34] 2025-11-15 고스트 프로그램 수정사항

- 게시판 오류 수정:
  js/core.js 에서 SPREADSHEET_URL 상수를 추가하고,
  SHEET_CSV_URL 과 동일한 Apps Script 웹앱 주소를 사용하도록 설정했습니다.
  이로 인해 "시트 주소가 설정되지 않아 게시판을 사용할 수 없어요." 메시지가 더 이상 뜨지 않습니다.

- 출석 도장 팝업 수정:
  js/attendance-weekly.js 의 requestStampToday() 함수에서
  postToSheet 의 응답(Response)을 그대로 쓰던 문제를 수정하고,
  res.json() 으로 Apps Script 의 JSON 응답을 파싱하도록 변경했습니다.
  이제 로그인 성공 후 첫 출석 시 자동으로 출석 도장 팝업이 정상적으로 뜹니다.

## v8 변경 사항 요약
- 출석 도장(주간) 모듈: 첫 로그인 자동 팝업 C 방식 유지 + 중복 팝업 방지 보강, 빈 도장으로 초기화되는 문제 완화(서버 응답이 비어도 기존 기록 보존).
- 게시판(board-inner) 위치: 화면 하단 기준 고정 배치로 복원.
- 캐릭터 클릭 동작:
  - 빠른 더블클릭: 기존처럼 터치 경고 + 부끄러움/터치 반응 유지.
  - 수첩이 닫힌 상태에서 한 번 클릭: 수첩을 보여주는 멘트를 2~3개 중 무작위로 사용, 기본 '화면보기' 감정, 낮은 확률로 '부끄러움' 감정과 함께 "메모장만 살짝 볼까요?" 연출.
  - 수첩이 열린 상태에서 한 번 클릭: 수첩 닫기 토글.


## v9 변경 사항 요약 (게시판 위치/스크롤 + 수첩/말풍선 동작 정리)

- 게시판 패널 위치/스크롤
  - `.board-inner`의 `bottom` 값을 20px → 60px 으로 조정하여, 패널이 화면 하단에서 조금 더 위(중앙에 가까운 위치)에 나오도록 수정했습니다.
  - `max-height` 를 78vh 로 늘리고 `overflow: hidden`을 추가하여, 안내 문구와 페이지네이션을 포함한 모든 내용이 패널 안에 머무르도록 했습니다.
  - `.board-body`에 `flex: 1`, `min-height: 0`, `overflow-y: auto` 를 부여하여, 게시글 목록이 길어질 경우 패널 내부에서만 세로 스크롤이 생기도록 변경했습니다.  
    → 이제 "아래에 제목을 누르면 내용을 확인할 수 있습니다." 안내 문구가 패널 밖으로 밀려 내려가지 않습니다.

- 게시판 헤더 레이아웃
  - `<div class="board-header">` 내부 요소 순서를 `제목 → 닫기 버튼` 에서 `닫기 버튼 → 제목` 순으로 변경했습니다.
  - `.board-header` 의 정렬을 `space-between` → `왼쪽 정렬 + gap` 으로 바꿔 X 닫기 버튼이 왼쪽 상단에 고정되도록 했습니다.

- 수첩(메뉴)와 게시판/배경 까만 네모(백드롭) 충돌 해결
  - `openNotebookMenu()` 에서 수첩을 열기 전에 `closeBoardPanel()` 을 우선 호출하도록 수정했습니다.
  - `closeBoardPanel` 함수가 없을 경우에는 `#boardPanel` 의 `open/hidden` 클래스를 직접 정리해서, 게시판 백드롭(까만 네모)이 수첩 오버레이와 겹쳐 보이지 않도록 했습니다.

- 캐릭터 클릭 시 수첩 열고/닫을 때 대사 & 감정 연출
  - 수첩이 닫힌 상태에서 한 번 클릭:
    - 기존과 동일하게 "수첩 보여드릴게요." / "오늘 기록들을 한 번 같이 볼까요?" / "수첩 펼쳐서 같이 확인해 볼게요." 중 하나를 무작위로 사용.
    - 기본은 `화면보기` 감정을 사용하고, 낮은 확률로 `부끄러움` 감정 + "어… 메모장만 살짝 볼까요? 조금 부끄럽네요." 대사를 출력.
  - 수첩이 열린 상태에서 한 번 클릭:
    - 기쁨 감정으로 전환하고,  
      "다 봤다면 수첩은 제가 다시 챙겨둘게요.",  
      "수첩은 여기까지! 필요하면 언제든 다시 열어 달라고 해주세요.",  
      "기록은 안전하게 보관해 둘게요. 이제 다시 이야기할까요?",  
      "다 봤으면 수첩은 잠시 제가 가지고 있을게요."  
      중 하나를 무작위로 말하면서 수첩을 닫도록 변경했습니다.
  - 빠른 더블클릭:
    - 여전히 기존 `handleTouch()` 반응(터치하지 말라는 느낌의 부끄러움/터치 모션)을 그대로 사용합니다.
    - 동시에 "잠깐만요! 한 번만 눌러도 수첩을 볼 수 있어요." 식의 경고 멘트를 함께 출력하여, 수첩을 열고 싶으면 한 번만 눌러 달라는 안내를 덧붙였습니다.
    - 이 경로에서는 수첩을 열지 않습니다.

- 수첩(메뉴) + 말풍선 위치 조정
  - `notebook-menu.js` 에서 수첩이 열릴 때 `#bubbleWrapper` 에 `menu-open` 클래스를 붙이고, 닫힐 때는 제거합니다.
  - `ghost.css` 에서 `#bubbleWrapper.menu-open`의 `bottom` 값을 데스크톱/모바일 각각 따로 조정하여,
    수첩이 열려 있어도 말풍선이 메뉴에 가려지지 않고 캐릭터 머리 위보다 조금 높은 위치에 자연스럽게 떠 있도록 맞췄습니다.


---

## 9. 채팅 입력창 placeholder 및 사용 설명서 패널 (v27)

- `js/chat-placeholder.js` 모듈
  - 채팅 입력창의 placeholder 문구에 현재 캐릭터 이름을 반영합니다.
    - 예: 미나 선택 시 → `"미나에게 뭐든 물어보거나 말을 걸어보세요. (예: 가위바위보, ~가 궁금해)"`
  - 캐릭터를 변경할 때(`setCurrentCharacter`) 자동으로 placeholder를 다시 적용합니다.
  - 이 파일을 삭제하면 index.html에 적힌 기본 placeholder만 사용됩니다.

- `js/manual-panel.js` 모듈 + `#manualPanel` 블록
  - 플러스(+) 버튼의 📖 `사용 설명서` 항목을 누르면, 기능 목록과 상세 설명을 패널 형태로 보여 줍니다.
  - 좌측에는 기능 이름 버튼(기본 대화, 가르치기, 캐릭터 변경, 미니 게임, 수첩/게시판, 기타 기능)이 목록으로 표시되고,
    버튼을 누르면 우측에 해당 기능의 상세 설명이 나타납니다.
  - 이 모듈을 제거하려면 js/manual-panel.js, index.html의 `#manualPanel` 블록, ghost.css의 `.manual-panel` 관련 스타일을 함께 삭제하면 됩니다.

- `showUsageGuide()` 동작 변경
  - 사용자가 채팅창에 '설명서', '사용법', '도움말' 등을 입력하면,
    고스트가 간단한 안내 멘트를 말하고, 사용 설명서 패널을 함께 열어 줍니다(가능한 경우).


### v28 추가 조정: 모바일 고스트 우측 오프셋
- 모바일에서 고스트가 충분히 오른쪽에 붙어 있지 않다는 피드백 반영.
- `css/ghost.css` 내 모바일 전용 블록에서 `right: -6px;` → `right: -60px;` 로 수정.
- 스케일 2.0 확대와 스프라이트 투명 여백을 고려한 보정값.
- 다른 화면(PC)과 모듈에는 영향 없음.


### v29: 게임 감정 반응 모듈 재구성 + 모바일 고스트 추가 위치 조정

1. 모바일 고스트 위치
- 기존 v28에서 `right: -60px;` 로 조정했으나, 여전히 여백이 남는다는 피드백을 반영했습니다.
- `css/ghost.css` 의 `@media (max-width: 768px)` 블록에서
  - `right: -60px;` → `right: -110px;` 로 한 번 더 조정했습니다.
- 2배 스케일된 스프라이트의 투명 여백까지 고려한 값으로,
  실제 화면에서는 고스트가 훨씬 더 오른쪽에 밀착되어 보입니다.
- PC 화면 및 다른 모듈에는 영향을 주지 않습니다.

2. 게임 감정 반응 구조 재설계
- 기존: js/game-manager.js 내부에 REACTIONS 상수와 window.gameReact() 가 함께 정의되어 있었습니다.
  - 오버레이 관리, BGM 제어, 감정 반응 로직이 한 파일에 섞여 있어 유지보수가 어렵고,
    게임 관련 감정 기능만 분리해서 끄기가 힘든 구조였습니다.
- 변경:
  - js/game-manager.js 에서 REACTIONS 및 window.gameReact 관련 코드를 제거하고,
  - 새 독립 모듈 `js/game-emotion.js` 를 추가했습니다.
- `js/game-emotion.js` 특징:
  - REACTIONS( start / good / miss / gameover / exit )와 window.gameReact(type)을 이 모듈에서만 관리합니다.
  - 각 게임 HTML에서 `_safeGameReact(type)` 을 호출하면,
    부모 창의 `gameReact(type)` 이 실행되어 감정 및 (필요 시) 말풍선을 갱신합니다.
  - 삭제 방법:
    - js/game-emotion.js 를 삭제하면 게임 관련 감정 반응만 비활성화되고,
      나머지 기능(채팅, 기본 감정, 말풍선 등)은 그대로 유지됩니다.
- 의도:
  - "게임에서의 감정 반응"을 완전히 별도 모듈로 떼어내어,
    필요 시 파일 하나만 삭제/교체할 수 있도록 구조를 단순화했습니다.

- `good` 타입 반응(정답/성공 시)은 `만세`, `기쁨`, `신남` 중에서 무작위로 선택하되,
  바로 직전에 사용된 감정은 가능한 한 다시 나오지 않도록 조정했습니다.


### v31: 게임 반응 가시성 개선 + 출석 도장 팝업 2회 표시 방지

1. 게임 감정 반응 가시성 강화
- js/game-emotion.js
  - `gameReactCore(type)`에서 모든 타입(start/good/miss/gameover/exit)에 대해,
    감정만 바꾸는 것이 아니라 `showBubble(line)`도 함께 호출하도록 변경했습니다.
  - 이제 정답을 맞추거나 게임을 시작/종료할 때,
    고스트가 한 줄 멘트를 말풍선으로 함께 보여 주기 때문에
    "반응이 없는 것처럼 보이는" 상황을 줄였습니다.
  - `cfg.emotions` 참조 부분의 오타로 인해 감정 선택이 실패할 수 있던 부분을
    `cfg.emotions` 기준으로 다시 정리하여 안정화했습니다.

2. 출석 도장 팝업이 두 번 뜨는 문제 수정
- js/attendance-stamp.js
  - 사용자가 출석 패널을 닫은 시각을 `lastManualCloseTime`으로 기록합니다.
  - 서버에서 출석 상태를 다시 받아와 패널을 여는 `openPanelWithLoad(user)` 내부에서,
    `lastManualCloseTime` 이후 1.5초 이내에는 `overlay.classList.add("open")`를
    실행하지 않도록 가드 로직을 추가했습니다.
  - 이로 인해,
    - 메뉴에서 출석 패널을 열었다가 바로 닫은 경우,
    - 또는 자동 출석 처리 직후 사용자가 패널을 닫은 경우에도
      비동기 응답으로 인해 패널이 "다시 뜨는" 상황을 방지합니다.


### v32: 게임 감정 모듈 안정화 및 출석 팝업 재오픈 완전 차단

1. 게임 감정 모듈 재작성
- js/game-emotion.js 파일을 문법/구조 오류 없이 처음부터 다시 구성했습니다.
  - REACTIONS(start/good/miss/gameover/exit) 정의는 그대로 유지하되,
    감정 선택/적용 로직을 전부 정리했습니다.
  - `pickEmotion(type)`에서 직전 감정과 2연속으로만 겹치지 않도록 조정합니다.
  - `gameReactCore(type)`에서는 감정만 변경하고, 게임에서 말풍선을 따로 띄우지 않습니다.
    (사용자 요청: "게임에서 정답 맞출 때, 게임 끝낼 때 말풍선은 필요 없음")
- 이 모듈 하나만 삭제하면 게임 관련 감정 반응이 모두 비활성화되며,
  다른 기능에는 영향을 주지 않는 독립 구조는 동일하게 유지됩니다.

2. 출석 도장 팝업 재오픈 차단 시간 확장
- js/attendance-stamp.js
  - 메뉴에서 출석 패널을 연 뒤 사용자가 닫았을 때,
    비동기 응답 때문에 다시 패널이 열리는 문제를 더 확실하게 막기 위해,
    `openPanelWithLoad(user)` 내부 가드 조건을 완화했습니다.
  - `now - lastManualCloseTime < 1500` (1.5초) → `< 600000` (10분) 으로 변경하여,
    사용자가 출석창을 닫은 뒤 일정 시간 동안은
    네트워크 응답이 도착해도 자동으로 패널을 다시 열지 않도록 했습니다.


### 2025-11-18 랭킹 왕관 모바일 크기/위치 보정

- `js/ranking_crown.js`
  - `injectCrownStyle()` 내부 스타일에 **모바일 전용(@media max-width: 700px)** 규칙을 추가해서, 휴대폰 화면에서
    - 왕관 가로/세로 크기를 PC 대비 조금 더 작게
    - 왕관 상단 위치를 살짝 위쪽으로
    - 텍스트/반짝이 이펙트 크기를 함께 축소
  - 결과적으로 모바일에서도 **PC 버전과 비슷한 비율로 캐릭터 머리 위에 왕관 + 텍스트가 표시**되도록 조정했습니다.


### 2025-11-18 편지 보내기 (이름 우선) & Apps Script URL 교체

- `js/letters-local.js`
  - 편지 폼에서 "받는 사람 이름"을 먼저 입력하고, "받는 사람 ID"는 선택 입력으로 변경했습니다.
  - 검증 로직을 수정하여 **이름 또는 ID 중 하나만 채워도** 편지를 보낼 수 있습니다.
  - 이름이 적혀 있을 때는, 두 번째 칸(ID)에 틀린 값이 있더라도 **ID는 무시되고 이름 기준으로 서버에서 user_id를 찾도록** 동작합니다.
  - 받은 편지가 없을 때 상태줄에 뜨던 안내 문구를 제거하고, 오른쪽 패널의 "아직 받은 편지가 없어요."만 사용합니다.

- `js/core.js`, `js/ranking.js`, `js/ranking_crown.js`, `js/game-ranking-report.js`
  - 시트 조회/쓰기 및 랭킹 조회에 사용하는 Apps Script URL을 모두 다음 주소로 통일했습니다.
    - https://script.google.com/macros/s/AKfycbx20pswdHDFUBSjQuuuy93O7H75CZdF1lxjTPfWe4YXyXpTRwTX-Pn5n9i0Zr43Je8qig/exec


### 2025-11-18 편지함 UI 게시판 스타일 개편

- `js/letters-local.js`
  - "받는 사람 ID (선택)" 필드를 완전히 제거했습니다. 이제 **받는 사람 이름 + 제목 + 내용**만 입력하면 편지가 전송됩니다.
  - 편지창 우측 상단에 "새로고침", "편지 쓰기" 버튼을 추가하고, 편지 쓰기 패널은 게시판처럼 토글되는 구조로 변경했습니다.
  - 받은 편지 목록을 `board-item` 스타일을 재사용하여 **게시판과 유사한 리스트 형태**로 표시합니다.

- `css/ghost.css`
  - `.letter-right-top`, `.letter-actions`, `.letter-action-btn` 등 편지함 상단 버튼/레이아웃 스타일을 추가했습니다.
  - `#letterComposePanel.hidden` 에 `display: none;`을 적용하여 편지쓰기 패널을 자연스럽게 열고 닫을 수 있게 했습니다.
  - 모바일에서 편지쓰기 패널이 아래쪽으로 배치되도록 `.letter-body`의 그리드 구성을 조정했습니다.


---

### 2025-11-18 말풍선 TTS 읽어주기 기능 추가 (v30)

- **신규 모듈** `js/tts-voice.js`
  - 브라우저 Web Speech API(`speechSynthesis`)를 사용해 고스트가 말하는 **말풍선 텍스트를 한국어 TTS로 읽어줍니다.**
  - 기본값은 **켜짐(on)** 상태이며, `localStorage("ghostTTSOn")`에 on/off 상태를 저장하여 새로고침 후에도 유지됩니다.
  - 공개 객체 `window.ttsVoice`:
    - `ttsVoice.speak(text)` : 주어진 텍스트를 한 번 읽기
    - `ttsVoice.toggle()` : on/off 토글하고 현재 상태(`true/false`) 반환
    - `ttsVoice.setEnabled(bool)` : 명시적으로 on/off 설정
    - `ttsVoice.refreshLabel()` : 수첩 메뉴 안의 "읽어주기(on/off)" 메모지 라벨을 현재 상태에 맞게 갱신
  - 이 파일을 삭제하면 읽어주기 기능은 완전히 사라지며, `core.js` 안 `showBubble()` 상단의 `ttsVoice.speak` 호출 부분 정도만 정리하면 됩니다.

- `js/core.js`
  - `function showBubble(text)` 상단에 **옵션 훅**을 1줄 추가:
    - `if (window.ttsVoice && typeof window.ttsVoice.speak === "function") { ... }`
  - 이 훅은 `tts-voice.js`가 없으면 자동으로 무시되므로, 모듈 삭제 시에도 에러 없이 동작합니다.

- `index.html` 수첩(메뉴) 메모지
  - 오른쪽 하단 "AR 카메라" 메모지를 **"읽어주기(on)"** 로 이름 변경.
  - `data-page="arcamera"` 속성은 그대로 두고, 동작은 `notebook-menu.js`에서 TTS 토글로 재매핑했습니다.

- `js/notebook-menu.js`
  - `case "arcamera"` 분기를 **AR 카메라 플레이스홀더 → 읽어주기(TTS) on/off 토글 버튼** 으로 변경.
    - Web Speech API 지원 + `tts-voice.js` 존재 시:
      - 상태를 토글하고, 말풍선으로
        - on: `"이제 말풍선을 읽어줄게요."`
        - off: `"앞으로는 조용히 말풍선만 띄울게요."`
        라고 안내.
    - TTS 미지원 브라우저에서는 `"이 브라우저에서는 읽어주기 기능을 사용할 수 없어요."` 만 안내.

이 버전에서 **읽어주기 기능을 완전히 끄고 싶다면**:
1. `index.html`에서 "읽어주기(on)" 메모지 버튼을 원래대로 수정하거나 삭제하고,
2. `js/notebook-menu.js` 의 `case "arcamera"` 블록을 정리,
3. `js/tts-voice.js` 파일을 삭제한 뒤,
4. 필요하다면 `js/core.js`의 `showBubble()` 안 TTS 훅 주석/코드를 삭제하면 됩니다.


## v40 모바일 레이아웃 보정 (2025-11-18)
- 모바일에서 채팅 도크(#chatDock)를 네비게이션 바 바로 위에 가깝게 위치 조정.
- 고스트(#ghostContainer), 말풍선(#bubbleWrapper), 랭킹 왕관 위치를 전체적으로 조금 아래로 내려 모바일 화면 비율에 맞춤.
- 수첩(메뉴) 패널(.notebook-wrapper)을 모바일에서 화면 중앙 근처에 표시되도록 수정.
- 로그인 패널(.login-inner)을 모바일에서 화면 중앙 근처에 고정하고, 키보드 등장 시에도 형태 변화가 적도록 최대 크기 제한 및 위치 보정.

- 모바일 수첩(메뉴) 위치: css/ghost.css 의 `.notebook-wrapper` bottom 값을 160px 로 조정.

- 모바일에서 로그인 패널이 키보드 입력 시 튀지 않도록 `.login-panel.keyboard-open .login-inner` 를 중앙 고정 스타일로 변경.

## v45 wave & voice tweak
- TTS 음성 설정을 기본 톤으로 복원 (속도/피치 1.0).
- 기본 배경의 파란 물결 두 줄을 화면 중앙으로 이동하고, 선을 조금 더 두껍게 조정.
- 고스트가 말할 때 waveBackground에 활성 효과를 주어 파동이 더 크게 흔들리도록 개선.

## v45 fortune & wave tuned (2)
- 음성 입력 더블탭 구현 중 발생하던 onPressStart 참조 에러 수정.
- fortune-today.js를 index.html에 연결하여 '오늘의 운세' 기능이 실제로 동작하도록 수정.
- SVG 물결 배경 코드를 삭제 후 단순 translateX 기반의 부드러운 2중 파도 애니메이션으로 재작성.
- 물결 선 굵기를 1.5로 조정하고, JS에서 waveBackground에 active 클래스를 더 이상 사용하지 않도록 정리.


## v45_train_mobile_snow_namefix_patch
- 모바일 열차 배경 레이아웃 보정 (부분 확대 적용)
- 모바일 환경에서 맵 미니 아이콘 및 전체 맵 숨김
- 눈 내리는 배경에서 눈 클릭 시 녹는 기능 제거 (시각 효과만 유지)
- 초기 실행 시 기본/눈/열차 3가지 맵 중 하나를 무작위로 선택하도록 변경

## 2025-11-19 패치: 모바일 열차 배경(wall1) 확대
- 모바일 화면(@media max-width: 768px)에서 `#bg-front`(wall1 열차 전경) 폭을 120% → 약 3배인 315%로 확대.
- wallpaper1 배경 위에 열차 전경이 크게 덮어지도록 표현하여, PC에서 보이는 열차 구간을 모바일에서도 확대된 부분 화면처럼 보이도록 조정.


### 2025-11-19 로그인 패널 고정 중앙 배치 (v45)
- `css/ghost.css`
  - `.login-inner` 기본 위치를 `bottom: 260px` 기준 배치에서 **화면 정중앙 고정**으로 변경했습니다.
    - `top: 50%`, `left: 50%`, `transform: translate(-50%, -50%)` 조합으로, 화면 크기와 상관없이 항상 가운데에 표시됩니다.
  - `.login-panel.open .login-inner` 도 동일한 transform을 사용하도록 수정하여, 열릴 때 위아래로 살짝 움직이는 애니메이션이 로그인 위치에 영향을 주지 않습니다.
- `js/mobile-ui.js`
  - 모바일 가상 키보드 열림/닫힘에 따라 `.login-panel`에 `keyboard-open` 클래스를 붙였다 떼는 **로그인 패널 위치 보정 로직을 완전히 제거**했습니다.
  - 이제 이 모듈은 **모바일 주소창 최소화(scrollTo(0,1))만 담당**하며, 로그인 창 위치는 전적으로 CSS에서만 제어합니다.

> 🔧 이 기능을 끄고 싶다면?
> - 로그인 위치를 다시 예전처럼 하단 기준으로 되돌리고 싶다면, 위 CSS 수정 부분만 되돌리면 됩니다.
> - 모바일 주소창 최소화 자체를 끄고 싶다면 `js/mobile-ui.js` 파일을 삭제하거나, `index.html`에서 해당 스크립트 태그를 제거하면 됩니다. (다른 기능에는 영향 없음)


## 2025-11-19 AR 카메라 / QR / 스티커 모듈 추가 (v46)
- `js/ar-camera.js`
  - 수첩(메뉴)의 **AR 카메라 메모지(data-page="arcamera")**를 눌렀을 때 뜨는 전용 오버레이를 구현했습니다.
  - 일반 카메라 미리보기, **QR 코드 스캔**, 화면을 톡톡 눌러 붙이는 **스티커(이모지) 모드**를 한 화면에서 제공합니다.
  - QR 인식은 `jsQR` 라이브러리를 CDN으로 동적으로 불러와 사용하며, 인식된 내용은 안내 문구와 고스트 말풍선(가능한 경우)으로 같이 보여 줍니다.
- HTML 연결
  - `index.html` 하단 스크립트 영역에 `<!-- [옵션 기능] AR 카메라 모듈 -->` 주석과 함께 `<script src="js/ar-camera.js"></script>`를 추가했습니다.
- 모듈 제거 방법
  1. `index.html`에서 `js/ar-camera.js` 스크립트 태그 한 줄을 삭제하고
  2. `js/ar-camera.js` 파일을 삭제한 뒤
  3. `js/notebook-menu.js` 안의 `case "arcamera"` 블록을 함께 삭제하면,
     AR 카메라 기능과 관련된 코드가 모두 사라집니다. (다른 기능에는 영향 없음)


### v46 AR 카메라 확장
- QR 스캔:
  - QR 코드 안에 **URL(https:// 또는 http://, 혹은 www.로 시작하는 문자열)** 이 있으면, 인식 즉시 해당 주소로 이동합니다.
- 캡처 & 자동 저장:
  - 셔터 버튼을 누르면 현재 카메라 화면을 캔버스로 캡처하고, **PNG 이미지로 자동 다운로드**를 시도합니다.
  - 스티커 모드에서는 화면에 붙여 둔 이모지 스티커 위치까지 같이 그려서 저장합니다.


### v46 speech-input 조정
- `js/speech-input.js`
  - 모바일 환경에서 **보내기 버튼을 한 번만 탭해도 음성 인식이 켜지던 문제**를 수정했습니다.
  - 터치 기기에서는 `touchend` 기준 **빠른 두 번 탭(더블 탭)** 일 때만 음성 인식이 시작되며,
    데스크톱 환경에서는 `click` 기준 더블 클릭일 때만 음성 인식이 시작됩니다.

- v46: 오늘의 퀘스트(퀘스트 탐사) 카드에 링크 이동 시 도장 표시 & 일일 진행도 저장/초기화, 모든 미션 완료 시 패널 빛나는 효과 추가, 하단 안내 문구/도장 이미지 업데이트.

- 퀘스트 도장 및 지도 아이콘 이미지를 images/etcimage/ 아래로 이동해 관리.


## v57 알림/퀘스트/로그인 UI 조정 메모

- 로그인 패널의 메인 로그인 버튼 높이를 살짝 늘리고, 모서리를 완만한 직사각형 형태로 조정했습니다.
- 시계 기반 혼잣말 중 시간 관련 멘트 한 줄의 말투를 다른 대사들과 자연스럽게 어울리도록 다듬었습니다.
- `alarm.js` + `dialog.js` 연동:
  - "알람"이라고 말하면, 언제 불러줄지 물어보는 랜덤 멘트 3종 중 하나가 출력됩니다.
  - "3분 뒤에 말해줘", "5초 후에 불러줘"처럼 시간 + 말해줘/불러줘 패턴을 사용하면 알람 이벤트가 발생하고, 시간이 될 때 랜덤 멘트 5종 중 하나로 알려줍니다.
- 오늘의 퀘스트 창의 퀘스트 카드(`qe-card`)에 수첩 메모지와 비슷한 hover/클릭(눌렸을 때) 효과를 추가했습니다.


- 알람이 울릴 때의 문장을 조금 더 자연스럽게 다듬해서, "나를 불렀어"처럼 어색한 표현이 나오지 않도록 수정했습니다.
- 시간 관련 혼잣말과 경청 리액션(고개 끄덕끄덕) 문장을 다른 대사 톤과 자연스럽게 어울리도록 미세 조정했습니다.
- 혼잣말 팁(tips)에 퀘스트/게임 관련 문장 5개를 추가했습니다.


## v57 인터넷 창 열기 모듈 (web-launcher.js)

- 채팅창에 "구글 열어줘", "유튜브 켜 줘", "네이버 열어 줘"처럼 입력하면
  고스트가 한 줄 안내 멘트를 출력한 뒤, 새 브라우저 탭에서 해당 사이트를 열어줍니다.
- js/web-launcher.js 파일과 index.html 하단의 [외부 사이트 열기 모듈] <script>를 삭제하면
  이 기능은 완전히 제거됩니다.
- core.js 안의 [옵션 기능] 인터넷 사이트 열기 블록도 함께 삭제하면 됩니다.

## ghost-hide.js (캐릭터 숨기기 / 다시 나오기 모듈)

- 메인 화면에서 채팅창에 아래와 같이 입력하면 캐릭터가 투명해지거나 다시 나타납니다.
  - 숨기기: `숨어`, `사라져` (문장 안에 포함돼 있어도 인식)
  - 다시 나오기: `나와`, `이리와`, `이리와줘`, `이리와라`
- 숨은 상태에서도 캐릭터 영역은 그대로 클릭/터치 가능합니다. (opacity 0 처리)
- 캐릭터는 각각 다른 랜덤 대사를 말하면서 숨거나 다시 등장합니다.
- 모듈을 완전히 끄려면:
  1. `js/ghost-hide.js` 파일 삭제
  2. `index.html` 의 `<script src="js/ghost-hide.js">` 태그 삭제
  3. `js/core.js` 안의 `handleGhostHideCommand` 를 호출하는 블록을 같이 삭제하면 됩니다.


---

### 2025-11-21 v59_fixed 모바일 로그인 패널 가로폭 보정
- `css/ghost.css` 맨 아래에 `@media (max-width: 600px)` 블록을 추가하여, 모바일 화면에서만 `.login-inner`의 가로폭을 `min(420px, calc(100% - 32px))`으로 제한.
- PC 환경의 로그인 레이아웃은 그대로 유지하면서, 작은 화면에서 로그인 창이 오른쪽으로 잘리거나 스크롤바에 의해 너비가 줄어드는 문제를 줄이는 목적.


---

### 2025-11-24 코인 현황 표시 모듈 추가 (v61 coin-status)

- 상단 시간 표시 아래의 "퀘스트 현황 / 오늘의 과제 해결 (0/5)" 바로 아래에 **"나의 코인 (x/100)"** 라벨을 추가하는 모듈을 만들었습니다.
  - 로그인 안 된 상태: `나의 코인 (비활성화)` 로 표시.
  - 로그인 상태: Apps Script `mode=coin_status` 응답에 따라 `나의 코인 (현재코인/최대코인)` 으로 표시.
- 모듈 파일: `js/coin-status.js`
  - 이 파일과 `index.html` 의 `<script src="js/coin-status.js"></script>` 를 삭제하면, 코인 표시 기능은 깨끗하게 사라집니다.
- Apps Script 연동 예시는 `gas_coin_status_sample.txt` 에 따로 정리했습니다.
  - 스프레드시트의 **"보상"** 시트에서 `user_id / coin / limit` 를 읽어와 JSON `{ ok:true, coin, limit }` 형식으로 반환하도록 구현하는 예시입니다.


- 2025-11-24 v62
  - coin-status.js 개선
    - 로그인 정보가 window.currentUser 이 없더라도 localStorage("ghostUser")를 참고하도록 수정해서,
      새로고침 후 자동 로그인 상태에서도 코인 표시가 되도록 개선.
    - 서버 오류 발생 시 "나의 코인 (연결 오류)" 로 상태를 구분해서 표시.
    - "오늘의 과제 해결" 과 동일한 .quest-status-link 스타일을 재사용하여,
      상단 퀘스트 바에서 글꼴/색/크기가 통일되도록 수정.

- 2025-12-03 수학 탐험대 자동 게시판 기록 기능 추가
  - `games/math-explorer.html`
    - 별도의 수학 게임 HTML. 게임 오버 시 점수/라운드 정보를 parent 프론트로 전달합니다.
    - 제거하려면 index.html 의 관련 게임 호출(상단 별 탭)과 js/game-manager.js 의 launchGame4, js/menu-games.js 의 openMenuGame4, js/math-explorer-bridge.js, js/game-math-explorer-report.js 를 함께 삭제하세요.
  - `js/game-manager.js`
    - `launchGame4()`를 추가하여 `games/math-explorer.html`을 game4 슬롯으로 실행.
  - `js/menu-games.js`
    - `openMenuGame4()`를 추가하여 수첩 메뉴에서 안전하게 게임을 실행.
  - `js/notebook-menu.js`
    - 상단 별(★) 탭 클릭 시 `openMenuGame4()`를 호출하여 수학 탐험대 게임을 실행하도록 연동.
  - `js/game-math-explorer-report.js`
    - 수학 탐험대 게임 결과를 받아, 점수가 5000점 이상일 때 게시판에 자동으로 글을 남깁니다.
    - 제목 예: "(닉네임)께서 수학 탐험대 (선택모드)에서 '(선택한 캐릭터)'로 XXXX점을 달성하셨습니다. 축하드립니다."
    - 내용에는 날짜/시간, 도달 라운드, 점수, 모드, 캐릭터 정보를 기록합니다.
    - 제거 시 이 파일과 함께 games/math-explorer.html 에서의 브리지 스크립트, 상단 별 탭 연동 코드를 함께 삭제하세요.
  - `js/math-explorer-bridge.js`
    - games/math-explorer.html 내부에서 G.gameOver 를 후킹하여 게임이 끝났을 때 parent.reportMathExplorerResult(...) 를 호출합니다.
  - `css/ghost.css`
    - 게시판에서 "[게임자동기록]" 작성자의 글 제목을 더 두껍게 보이도록 `.board-item-title-auto` 클래스를 추가.

- 2025-12-03 코인 보상 연동 (출석/랭킹/퀘스트)
  - `js/coin-reward.js`
    - 주간 출석 5일 달성, 게임 랭킹 1위 달성, 하루 퀘스트 5개 모두 완료 시 Apps Script 웹 앱으로 코인 보상(`mode=coin_reward`)을 요청하는 공용 모듈입니다.
    - 제거 시 이 파일과 함께 index.html 의 `<script src="js/coin-reward.js"></script>` 태그, 그리고 아래 세 파일의 `window.__ghostCoinReward...` 호출부를 같이 삭제해야 합니다.
  - `js/attendance-stamp.js`
    - 자동 출석 도장 처리 후, 해당 주의 출석 일수가 5일 이상인 경우 `window.__ghostCoinReward.attendanceWeekIfEligible(days)` 를 호출하여 일주일 5일 출석 보상(+1)을 한 번만 요청합니다.
  - `js/quest-explorer.js`
    - 오늘의 퀘스트 5개를 모두 완료하는 순간 `window.__ghostCoinReward.questAllDoneToday()` 를 호출하여 하루 1회 퀘스트 올클리어 보상(+1)을 요청합니다.
  - `js/ranking.js`
    - 게임별 랭킹 목록을 불러온 뒤, 현재 로그인한 사용자가 해당 게임 랭킹 1위인 경우 `window.__ghostCoinReward.rankingIfFirst(gameName, list)` 를 호출하여 게임별 1위 보상(+2)을 한 번만 요청합니다.
  - Apps Script (coin.gs / Code.gs) 쪽에서는 `mode=coin_reward` 를 받아 처리하는 핸들러와, `보상로그` 시트를 이용해 `user_id + reward_type + reward_key` 조합별로 보상이 한 번만 지급되도록 중복 방지 로직을 구현해야 합니다.


- 2025-12-04: 게시판 시간 표시 개선 (시/분만 표시) 및 AR 카메라 스티커 모드 캐릭터 위치/동기화 수정.


- 2025-12-08: 랭킹 표시 및 수학 탐험대 모드 구분 개선
  - `js/ranking.js`
    - 현재 로그인하지 않은 경우(localStorage 의 과거 로그인 정보만 있는 상태 포함) 랭킹 팝업 하단의 "내 최고 기록" 영역에 점수가 표시되지 않도록 변경했습니다.
    - `getCurrentUserId()`는 이제 `window.currentUser.user_id` 값만 사용하며, localStorage("ghostUser") 값은 더 이상 사용하지 않습니다.
    - 랭킹 탭을 빠르게 전환할 때 이전 게임의 랭킹 응답이 뒤늦게 도착해 화면을 덮어쓰는 현상을 막기 위해 `lastRankingGameName` 변수를 추가하고, `loadRankingList()`에서 가장 마지막에 요청된 게임 이름과 일치하는 응답만 화면에 반영하도록 수정했습니다.
  - `js/math-explorer-bridge.js`
    - 수학 탐험대 하드 모드 여부를 판별할 때 다음 세 곳을 모두 확인하도록 변경했습니다.
      - games/math-explorer.html 내 top-level `let hardMode = true/false;`
      - `gameGlobal.hardMode`
      - `window.hardMode`
    - 이 중 어느 하나라도 true 이면 하드 모드로 취급하여, 게시판 자동 기록에 "하드 모드" / "일반 모드"가 정확히 구분되도록 했습니다.


### 2025-12-10 소통 채팅 토글 및 채팅창 드래그 버그 수정 (v71 social_chat_resizeOnTop_globalNoHighlight)
- `js/social-chat-firebase.js`
  - `initSocialChat()` 함수 내부 구조를 다시 작성하여 스크립트 파싱 오류를 제거.
  - 채팅창 왼쪽 상단의 소통 토글 버튼(`#socialToggleBtn`)과 플러스(+) 메뉴의 `마이파-톡` 메뉴가
    `toggleSocialChatMode()` → `toggleMode()`로 정상 연결되도록 정리.
  - `log` 영역 스크롤 이벤트(`onLogScroll`)가 항상 바인딩되도록 수정하여,
    위로 스크롤 시 더 많은 소통 메시지가 보이도록 함.
  - 채팅창 상단을 잡고 위/아래로 드래그하면 `log` 영역의 `max-height`를 240~420px 사이에서 조절하면서
    보이는 소통 메시지 개수(viewCount)가 자연스럽게 바뀌도록 드래그 로직을 재구성.
  - 에러 발생 시 전체 소통 채팅 모듈이 멈추지 않도록 `try/catch` 범위를 유지하며 정리.



### 2025-12-10 전역 길게 누르기/우클릭 하이라이트 방지 및 소통 드래그 영역 보정

- `js/global-interaction-guard.js` (신규)
  - 화면 전체에서 입력창/텍스트영역을 제외한 요소에 대해 텍스트 선택(`selectstart`), 드래그 시작(`dragstart`),
    컨텍스트 메뉴(`contextmenu`) 이벤트를 가로채어 `e.preventDefault()` 처리하도록 추가했습니다.
  - 이로 인해 창이나 이미지를 길게 눌렀을 때 파란 선택 영역이나 우클릭 메뉴가 뜨지 않고,
    기존의 클릭/터치 동작은 그대로 유지됩니다.
  - 제거 시에는 index.html 하단 `<script src="js/global-interaction-guard.js"></script>`도 함께 삭제해야 합니다.

- `js/social-chat-firebase.js`
  - 채팅창 상단 드래그 시작 인식 범위를 기존 `rect.top + 20`에서 `rect.top + 40`으로 넓혀,
    사용자가 채팅창 상단을 조금 여유 있게 집어서 끌어올릴 수 있도록 보정했습니다.
  - 드래그 시작 판정 임계값(MOVE_THRESHOLD)을 4 → 3으로 낮춰, 작은 손가락 움직임에도 드래그가 보다 부드럽게 인식되도록 조정했습니다.



### 2025-12-10 startup.js 재작성 및 전역 인터랙션 가드 정리

- `js/startup.js`
  - 기존 파일에 들어 있던 `window.addEventLi...` 형태의 잘린 코드로 인해 스크립트 전체가 구문 오류를 일으키던 문제를 제거하고,
    페이지 로드 후 각 모듈의 `init*` 함수를 순서대로 호출하는 단순한 초기화 허브 스크립트로 재작성했습니다.
  - 호출 대상: `init`, `initActions`, `initTeachUI`, `initBoardUI`, `initNotebookMenu`, `initManualPanel`,
    `initLoginModule`, `initClockWidget`, `initFullscreenButton`, `initBackgroundSystem`.
  - 고스트 영역에만 따로 `contextmenu`를 막던 코드는 삭제하여, 전역 인터랙션 가드 모듈 한 곳에서만 우클릭/길게누르기 방지 로직을 관리하도록 정리했습니다.

- `css/ghost.css`
  - 전역 `html, body, body *` 에 적용되던 `user-select: none;` 규칙은 그대로 유지하되,
    `input`, `textarea`, `contenteditable="true"` 요소에 대해서는 다시 `user-select: text;`를 지정하여
    입력창/텍스트 영역에서는 선택 및 복사가 가능하도록 예외를 추가했습니다.


### 2025-12-10 채팅 이모티콘 선택 기능 뼈대 추가

- `images/emotion/`
  - 채팅 이모티콘 전용 이미지 폴더를 새로 만들었습니다.
  - 실제 이미지는 `e1.png` ~ `e12.png` (총 12개)를 이 폴더 안에 넣어 사용합니다.
  - 현재는 `README_emotion.txt`만 들어 있으며, 추후 이미지를 교체/추가하면 별도 코드 수정 없이 바로 반영됩니다.

- `js/chat-emoji.js` (신규 모듈)
  - 채팅창 입력줄 오른쪽에 이모티콘 선택 버튼을 추가하고, 이를 눌렀을 때 4x3(총 12개) 그리드로 이모티콘을 표시하는 패널을 생성합니다.
  - 각 이모티콘은 프론트에서 `images/emoticon/e1.png` ~ `e12.png` 경로로 직접 로딩되며,
    서버/Firebase/시트에는 실제 이미지가 아닌 `:e1:` ~ `:e12:` 형태의 코드만 전송되도록 설계했습니다.
  - `window.initChatEmoji()`를 통해 초기화되며, `startup.js`에서 조건부로 한 번만 호출합니다.
  - `window.renderTextWithEmojis(text, container)`를 제공하여, 문자열 안의 `:e1:` ~ `:e12:` 토큰을
    `<img class="chat-emoji" src="images/emoticon/eN.png">` 형태로 치환해 주는 역할을 합니다.
  - 제거 시에는 index.html의 `#emojiBtn` / `#emojiPanel` HTML, `css/ghost.css`의 관련 스타일,
    그리고 `core.js`, `social-chat-firebase.js`, `startup.js`의 연동 부분도 함께 삭제해야 합니다.

- `index.html`
  - 채팅 입력 줄(`#inputRow`) 구조를 수정하여, `#userInput` 오른쪽에 이모티콘 버튼(`#emojiBtn`)과 패널 컨테이너(`#emojiPanel`)를 감싸는
    `.emoji-wrapper` 블록을 추가했습니다.
  - 스크립트 로드 순서 중 `js/dialog.js` 다음에 `js/chat-emoji.js`를 추가하고, 이후에 `js/startup.js`가 로드되도록 배치하여
    `initChatEmoji()`가 정상적으로 호출되도록 구성했습니다.

- `css/ghost.css`
  - `.emoji-wrapper`, `.emoji-btn`, `#emojiPanel`, `.emoji-grid`, `.emoji-item`, `.chat-emoji` 등의 스타일을 추가하여
    이모티콘 버튼과 4x3 그리드 패널이 기존 + 메뉴 스타일과 어울리도록 디자인했습니다.
  - 이모티콘 이미지는 12x12px 기준으로 표시되며, 필요한 경우 더 큰 해상도의 이미지를 넣고 CSS에서 축소해 사용할 수 있습니다.

- `js/core.js`
  - `logMessage(role, text)` 내에서 사용자/고스트 메시지를 표시할 때,
    `renderTextWithEmojis` 함수가 존재하면 이를 호출하여 `:e1:` ~ `:e12:` 토큰을 실제 이모티콘 이미지로 치환한 뒤 출력하고,
    함수가 없을 경우에는 기존처럼 단순 텍스트로 출력하도록 분기 처리했습니다.

- `js/social-chat-firebase.js`
  - 소통 채팅 렌더링(`renderSocialMessages`)에서도 `renderTextWithEmojis`를 사용하여
    소통 모드 메시지 안의 `:e1:` ~ `:e12:` 코드가 동일한 방식으로 이모티콘 이미지로 표시되도록 맞췄습니다.

- `js/startup.js`
  - 초기화 루틴 마지막 부분에 `initChatEmoji` 존재 여부를 확인한 뒤 호출하는 블록을 추가했습니다.
  - 이로 인해 이모티콘 모듈이 존재하지 않거나 제거된 경우에도 다른 기능에는 영향을 주지 않고 그냥 건너뛰도록 설계되어 있습니다.
